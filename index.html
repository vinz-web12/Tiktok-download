<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TikTok Downloader</title>
  <style>
    body {
      font-family: sans-serif;
      background: #0f0f0f;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: #1c1c1c;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }
    input {
      width: 90%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      background: #00ff99;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #00e68a; }

    video, img {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .photoItem {
      background: #1b1b1b;
      padding: 10px;
      border-radius: 12px;
      margin-top: 15px;
    }

    #slideContainer {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üéµ TikTok Downloader</h2>
    <input id="inputUrl" placeholder="Masukkan link TikTok..." />
    <button id="fetchBtn">Ambil Video</button>

    <div id="status"></div>

    <button id="audioBtn" style="display:none;">üéß Download Sound (MP3)</button>
    <video id="previewVideo" controls style="display:none;"></video>

    <div id="slideContainer"></div>

    <button id="downloadNow" style="display:none;">‚¨áÔ∏è Download Video</button>
  </div>

  <script>
    const input = document.getElementById("inputUrl");
    const fetchBtn = document.getElementById("fetchBtn");
    const status = document.getElementById("status");
    const previewVideo = document.getElementById("previewVideo");
    const downloadNow = document.getElementById("downloadNow");
    const audioBtn = document.getElementById("audioBtn");
    const slideContainer = document.getElementById("slideContainer");

    function randomName(prefix, ext) {
      const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
      let r = "";
      for (let i = 0; i < 8; i++) r += chars[Math.floor(Math.random() * chars.length)];
      return `${prefix}_${r}.${ext}`;
    }

    async function downloadFile(url, name) {
      try {
        const res = await fetch(url);
        const blob = await res.blob();
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = name;
        a.click();
      } catch {
        alert("Gagal mendownload file!");
      }
    }

    fetchBtn.onclick = async () => {
      const url = input.value.trim();
      if (!url) return alert("Masukkan link TikTok!");

      status.textContent = "‚è≥ Mengambil data...";
      previewVideo.style.display = "none";
      downloadNow.style.display = "none";
      audioBtn.style.display = "none";
      slideContainer.innerHTML = "";

      try {
        const res = await fetch(`https://www.tikwm.com/api/?url=${encodeURIComponent(url)}`);
        const data = await res.json();

        if (!data || !data.data) throw new Error("Video tidak ditemukan!");

        const d = data.data;

        // Jika konten berupa slide foto
        if (d.images && d.images.length > 0) {
          status.textContent = "üì∏ Slide foto siap!";

          // tombol sound di atas
          if (d.music && d.music.play_url) {
            audioBtn.style.display = "inline-block";
            audioBtn.onclick = () => downloadFile(d.music.play_url, randomName("sound", "mp3"));
          }

          // tampilkan semua foto + tombol di bawahnya
          d.images.forEach((img, i) => {
            const div = document.createElement("div");
            div.className = "photoItem";

            const image = document.createElement("img");
            image.src = img;
            image.alt = `Slide ${i + 1}`;

            const btn = document.createElement("button");
            btn.textContent = `‚¨áÔ∏è Download Slide ${i + 1}`;
            btn.onclick = () => downloadFile(img, randomName("slide", "jpg"));

            div.appendChild(image);
            div.appendChild(btn);
            slideContainer.appendChild(div);
          });

          return;
        }

        // Jika konten berupa video
        status.textContent = "üé¨ Video siap!";
        previewVideo.style.display = "block";
        previewVideo.src = d.play;
        previewVideo.load();

        downloadNow.style.display = "inline-block";
        downloadNow.onclick = () => downloadFile(d.play, randomName("video", "mp4"));

        if (d.music && d.music.play_url) {
          audioBtn.style.display = "inline-block";
          audioBtn.onclick = () =>
            downloadFile(d.music.play_url, randomName("sound", "mp3"));
        }

      } catch (e) {
        console.error(e);
        status.textContent = "‚ùå Gagal memuat video / foto!";
      }
    };
  </script>
</body>
</html>
